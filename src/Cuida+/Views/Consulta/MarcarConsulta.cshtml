@model Cuida_Models.ConsultaViewModel

@{
    ViewData["Title"] = "Marcar Consulta";
}

<div class="horario-container">
    <h2 class="titulo">Selecione um horário</h2>

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="erro-validacao">
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <p>@error.ErrorMessage</p>
            }
        </div>
    }

    @foreach (var medico in Model.Medicos)
    {
        var campanha = Model.Campanhas?.FirstOrDefault(c => c.Especialidade == medico.Especialidade);

        <div class="card-medico">
            <h4>@medico.Nome (@medico.Especialidade)</h4>

            @if (campanha != null)
            {
                <p><strong>Campanha:</strong> @campanha.Nome</p>
            }
            else
            {
                <p class="sem-horario">Nenhuma campanha aderente à especialidade.</p>
            }

            <form method="post" asp-action="MarcarConsulta">
                <label for="pacienteId">Paciente:</label>
                <select name="pacienteId" required>
                    @foreach (var paciente in Model.Pacientes)
                    {
                        <option value="@paciente.Id">@paciente.Nome</option>
                    }
                </select>

                <input type="hidden" name="medicoId" value="@medico.Id" />
                <input type="hidden" name="campanhaNome" value="@campanha?.Nome" />

                <label for="horario">Horário:</label>

                @if (medico.HorariosDisponiveis != null && medico.HorariosDisponiveis.Any())
                {
                    <select name="horario" required>
                        @foreach (var h in medico.HorariosDisponiveis)
                        {
                            <option value="@h">@DateTime.Now.ToShortDateString() às @h</option>
                        }
                    </select>
                    <button type="submit" class="btn-azul">Confirmar</button>
                }
                else
                {
                    <p class="sem-horario">Nenhum horário disponível para este médico.</p>
                }
            </form>
        </div>
    }
</div>

<style>
.horario-container {
    width: 440px;
    margin: 30px auto;
    font-family: 'Inter', sans-serif;
}

.card-medico {
    background: #FFFFFF;
    padding: 20px;
    margin-bottom: 25px;
    border-radius: 10px;
    box-shadow: 0px 4px 4px rgba(0,0,0,0.25);
}

h4 {
    font-weight: 700;
    margin-bottom: 10px;
    color: #000000;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: 600;
}

select {
    width: 100%;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
}

.btn-azul {
    background-color: #0D99FF;
    color: white;
    padding: 10px;
    border: none;
    border-radius: 5px;
    width: 100%;
    font-weight: bold;
    cursor: pointer;
}

.erro-validacao {
    background-color: #ffe0e0;
    border: 1px solid #ff4d4d;
    padding: 10px;
    margin-bottom: 20px;
    border-radius: 5px;
    color: #990000;
}

.sem-horario {
    color: #cc0000;
    font-weight: bold;
    margin-top: 10px;
}
</style>